<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

    <title>翻译spring-cloud的一篇文章 | 灯塔</title>
    <meta name="author" content="張日雄">
    
    <meta name="description" content="灯塔下的笔者">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="翻译spring-cloud的一篇文章"/>
    <meta property="og:site_name" content="灯塔下的笔者"/>

    
    <meta property="og:image" content="undefined"/>
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="灯塔下的笔者" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/prettify-tomorrow-night-eighties.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>


<body>
    <img src="/weixin_favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

    <nav class="indigo">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">灯塔下的笔者</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            分类
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-reading " href="/reading" >
                            <i class="fa fa-book "></i>
                            
                            读书
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-about " href="/about" >
                            <i class="fa fa-user "></i>
                            
                            关于
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            搜索
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav indigo darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="/css/images/avert.png" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">灯塔</p>
                        <p class="desc">灯塔下的笔者</p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    首页
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    归档
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    分类
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-reading " href="/reading" >
                    <i class="fa fa-book "></i>
                    
                    读书
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-about " href="/about" >
                    <i class="fa fa-user "></i>
                    
                    关于
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    搜索
                </a>
            </li>
        
    </ul>

    <ul class="side-nav indigo darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/源码阅读/">
                    源码阅读 <span class="right">7 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/源码阅读/security源码导读系列/">
                    security源码导读系列 <span class="right">5 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/源码阅读/lang包/">
                    lang包 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/源码阅读/JUC源码/">
                    JUC源码 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/大型网站技术架构/">
                    大型网站技术架构 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/日常技术/">
                    日常技术 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/心尘随笔/">
                    心尘随笔 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/翻译/">
                    翻译 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/爱上烧菜/">
                    爱上烧菜 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/爱上烧菜/熟食/">
                    熟食 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/教程/">
                    教程 <span class="right">2 篇</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">搜索</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


    <main>
        <div class="container main-container">
    <nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper indigo">
        <span class="breadcrumb">当前位置（分类目录）</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/翻译/">翻译</a>


        

        
    </div>
</nav>

<article>
    <div class="card">
        <div class="card-content">
            

            <div class="article-title">
                
    
        <h1>翻译spring-cloud的一篇文章</h1>
    


            </div>
            <time class="indigo-link-context" datetime="2016-11-26T04:26:13.705Z"><a href="/2016/11/26/translation/1/">2016-11-26</a></time>

            
    <div class="tags-row">
        
            <a href="/tags/spring-cloud/" class="chip green accent-4">spring-cloud</a>
        
            <a href="/tags/翻译/" class="chip green accent-4">翻译</a>
        
            <a href="/tags/微服务/" class="chip green accent-4">微服务</a>
        
    </div>


            <div class="toc indigo-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#什么是Spring-Cloud"><span class="section table-of-contents-text">什么是Spring-Cloud?</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#Spring-Boot"><span class="section table-of-contents-text">Spring Boot</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#服务发现和集成路由"><span class="section table-of-contents-text">服务发现和集成路由</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#配置服务（Configuration-Service）"><span class="section table-of-contents-text">配置服务（Configuration Service）</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#发现服务-Discovery-Service"><span class="section table-of-contents-text">发现服务(Discovery Service)</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#API-Gateway"><span class="section table-of-contents-text">API Gateway</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#例子项目"><span class="section table-of-contents-text">例子项目</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#Docker"><span class="section table-of-contents-text">Docker</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#混合持久化（Polyglot-Persistence）"><span class="section table-of-contents-text">混合持久化（Polyglot Persistence）</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#微服务架构（Microservice-architecture）"><span class="section table-of-contents-text">微服务架构（Microservice architecture）</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#服务发现（Service-discovery）"><span class="section table-of-contents-text">服务发现（Service discovery）</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#API-gateway"><span class="section table-of-contents-text">API gateway</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#Docker-例子"><span class="section table-of-contents-text">Docker 例子</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#开始这个项目"><span class="section table-of-contents-text">开始这个项目</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#下载Docker"><span class="section table-of-contents-text">下载Docker</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#要求"><span class="section table-of-contents-text">要求</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#构建这个项目"><span class="section table-of-contents-text">构建这个项目</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#开始使用Docker-Compose-来组成集群"><span class="section table-of-contents-text">开始使用Docker Compose 来组成集群</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#结论"><span class="section table-of-contents-text">结论</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#特别感谢"><span class="section table-of-contents-text">特别感谢</span></a></li></ol>
</div>


            <div class="entry indigo-link-context">
                <blockquote>
<p>导读：</p>
<ul>
<li>翻译：灯塔</li>
<li>校对：</li>
<li>翻译原文：<a href="http://www.kennybastani.com/2015/07/spring-cloud-docker-microservices.html" target="_blank" rel="external">http://www.kennybastani.com/2015/07/spring-cloud-docker-microservices.html</a></li>
<li>翻译目的：玩玩这个<a href="https://github.com/kbastani/spring-cloud-microservice-example" target="_blank" rel="external">https://github.com/kbastani/spring-cloud-microservice-example</a><br>注意：企业实现微服务化时，需要考虑团队的水平，技术成本，和当前的业务需求，业务体量，微服务实施也并不好玩，分布式会比单体架构难度大的多。</li>
</ul>
<hr>
</blockquote>
<h1 id="什么是Spring-Cloud"><a href="#什么是Spring-Cloud" class="headerlink" title="什么是Spring-Cloud?"></a>什么是Spring-Cloud?</h1><p>Spring-Cloud 是一套工具集合，用来提供解决方案构建分布式系统时遇到的一些常见的模式。如果你熟悉构建用spring 来构建应用，那么spring-cloud常用来构建它的一些常见的构建块。<br>在Spring-Cloud 提供的解决方案中，你可能要找一些工具来解决一下的一下问题：</p>
<ul>
<li>Configuration management（配置管理）</li>
<li>Service discovery(服务发现)</li>
<li>Circuit breakers（断融器）</li>
<li>Distributed sessions（分布式回会话）</li>
</ul>
<h1 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h1><p>这里大部分spring-cloud 的工作都是基于spring-boot 的基础上的。<br>下面谈论的一些东西对于spring-boot来说都是一些新的东西，下面的项目名称已经很大的程度上已经说明了他是干什么的。<br>你能在Spring框架和spring的生态圈中的到所有的最好的东西，调到完美，以最小的配置，为生产环境做好随时发布的准备。</p>
<h1 id="服务发现和集成路由"><a href="#服务发现和集成路由" class="headerlink" title="服务发现和集成路由"></a>服务发现和集成路由</h1><p>在为服务的架构中，每一个服务都有单独的作用。在用spring-cloud中构建微服务架构时，这里有一些概念需要首先去处理和熟悉的。第一和第二个微服务，将需要你去创建一个<strong>配置服务</strong>，和<strong>发现服务</strong>。在用spring-cloud中构建微服务架构时，这里有一些概念需要首先去处理和熟悉的。第一和第二个微服务，将需要你去创建一个<strong>配置服务</strong>，和<strong>发现服务</strong>。</p>
<p><img src="http://i.imgur.com/Dc6xjwd.png" alt="微服务" title="title"></p>
<p>上面的图片展示了一个4-microservice设置，连线表示了它们之间的依赖。</p>
<p><strong>配置服务</strong>，在顶部，用黄色表示，同时，它也被其他的微服务依赖。<strong>发现服务</strong>在低部，标记为蓝色，同时也被其他微服务依赖。</p>
<p>绿色，是代表2个微服务，这是这个例子的应用的一部分，我在这篇博客中叫他为 <strong>movies</strong> 和 <strong>recommendations</strong></p>
<h1 id="配置服务（Configuration-Service）"><a href="#配置服务（Configuration-Service）" class="headerlink" title="配置服务（Configuration Service）"></a>配置服务（Configuration Service）</h1><p>这个<strong>配置服务</strong>，在所有的微服务架构中都是一个非常重要的概念，基于<a href="http://12factor.net/config" target="_blank" rel="external">twelve-factor</a>应用方法,微服务的配置应该是在环境中得到存储，而不是仅仅在项目中。</p>
<p><strong>配置服务</strong> 是必须的，因为他为所有的微服务处理了配置，通过简单的点对点服务调用，来检索这些配置，这是多功能的优点。</p>
<p>让我们来总结一下，这个多个部署环境。如果我们有一个临时环境和生产环境，在这些环境中，我们的配置是不一样的，一个配置服务可能有一个专用的Git存储库的配置环境。没有其他的环境中能够访问这个配置<br>它是只提供给服务在该环境运行时的配置。</p>
<p><img src="http://i.imgur.com/J7FazPH.png" alt="微服务" title="title"></p>
<p>当<strong>配置服务</strong>开启后，它会根据配置路劲找到配置文件，去服务那些需要配置服务的微服务程序。每一个微服务都可以拥有他们的自己的配置，来处理一些正在运行的特殊环境。<br>在这个过程中，配置外部化和集中在一个地方，可以版本控制和修改，而无需重启服务改变配置。</p>
<p>可以利用spring-cloud 的节点管理，你可以让配置环境的改变，只是需要简单的刷新 <strong>发现服务</strong>， 这样就能强制让全部的服务消费者发现这个新的服务。</p>
<h1 id="发现服务-Discovery-Service"><a href="#发现服务-Discovery-Service" class="headerlink" title="发现服务(Discovery Service)"></a>发现服务(Discovery Service)</h1><p><strong>发现服务</strong>是微服务架构中的另外一个重要的组件。<strong>发现服务</strong>处理维护服务实例的列表可工作在一个集群中。在应用程序中，service - to - service调用是使用客户端来做。</p>
<p>以这个程序为例子，我使用<a href="https://github.com/spring-cloud-samples/feign-eureka" target="_blank" rel="external">Spring Cloud Feign</a>, 客户端是依赖于一个RESTful的API 的微服务,它起源于<a href="https://github.com/spring-cloud-samples/feign-eureka" target="_blank" rel="external">Netflix OSS</a>项目.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@FeignClient(&quot;movie&quot;)</div><div class="line">public interface MovieClient &#123;</div><div class="line">    @RequestMapping(method = RequestMethod.GET, value = &quot;/movies&quot;)</div><div class="line">    PagedResources findAll();</div><div class="line"></div><div class="line">    @RequestMapping(method = RequestMethod.GET, value = &quot;/movies/&#123;id&#125;&quot;)</div><div class="line">    Movie findById(@RequestParam(&quot;id&quot;) String id);</div><div class="line"></div><div class="line">    @RequestMapping(method = RequestMethod.POST, value = &quot;/movies&quot;,</div><div class="line">      produces = MediaType.APPLICATION_JSON_VALUE)</div><div class="line">    void createMovie(@RequestBody Movie movie);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在上面的例子，我创建了一个 模拟客户端，用RESTful 方法来暴露<strong>movie service</strong>。使用 <strong>@FeignClient</strong>注解，我首先指定我想为<strong>movice micro service</strong>来创建一个客户端的API。<br>接着，我指定一个我想要消费的微服务映射，我是通过在方法上声明URL的样式来做接口映射的（spring mvc类似），作为一个REST Ful 的路由映射。</p>
<p>创建一个模拟的客户端 是相当的简单，我们只是需要在我将要创建的客户端中，知道需要那个服务的ID。这个服务的URL将会在运行期间被自动配置，因为在集群中的每一个微服务在开启时它的ID都会被注册到<strong>发现服务</strong>中。</p>
<p>这同样适用于其他服务的microservice架构。我只是需要知道这个服务的Id,我就能和他做交互，这里的所有事情都会spring自动化了。</p>
<h1 id="API-Gateway"><a href="#API-Gateway" class="headerlink" title="API Gateway"></a>API Gateway</h1><p>API gateway 是另外一个重要的微服务，如果我们需要去创建一个微服务集群管理他们自己的领域实体类。绿色的六边形下面是数据驱动的服务，用来管理他们自己的领域模型实体类，以及他们自己的数据库。通过添加一个<strong>API gateway service</strong>， 我们可以创建一个API 路由的代理，并暴露给绿色的服务。<br><img src="http://i.imgur.com/JVSGMfY.png" alt="Alt text" title="Optional title"></p>
<p>现在，我们假设 <strong>recommendations service</strong> 和 <strong> movie service </strong> 都暴露他们自己的REST API 给领域实体管理。这个API gateway 将会通过<strong>discovery service</strong>发现他们的服务和他们依赖注入其他服务的代理路由方法。<br>通过这个方式，<strong> recommendation</strong> 和 <strong> movice </strong> 服务，将会有一个完整的定义; 本地的路由映射是可以利用所有暴露 REST API 的微服务。API Gateway 将会重新定义转发路由请求服务实例，用自己的路由开始通过HTTP来发出请求。</p>
<h1 id="例子项目"><a href="#例子项目" class="headerlink" title="例子项目"></a>例子项目</h1><p>我把全部的例子项目都放到了一起，演示了一个从头到尾的 使用Spring cloud 构建本地云平台的实践架构。</p>
<p>概念：</p>
<ul>
<li>使用Docker整合测试用例</li>
<li>混合持久化</li>
<li>微服务架构</li>
<li>服务发现</li>
<li>API gateway</li>
</ul>
<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p>每一个服务都是使用Docker来构建和发布的。从头到尾整合测试用例，能在一台开发机器中，使用Docker compose来做。</p>
<h1 id="混合持久化（Polyglot-Persistence）"><a href="#混合持久化（Polyglot-Persistence）" class="headerlink" title="混合持久化（Polyglot Persistence）"></a>混合持久化（Polyglot Persistence）</h1><p>这个示例项目的核心概念之一是在实践中如何走近通晓多种语言的持久性。Microservices项目中使用自己的数据库,同时结合数据从其他服务通过休息或一个消息总线。例如，你能有一个微服务，服务下面的数据库：</p>
<ul>
<li>Neo4j (graph)</li>
<li>MongoDB (document)</li>
<li>MySQL (relational)</li>
</ul>
<h1 id="微服务架构（Microservice-architecture）"><a href="#微服务架构（Microservice-architecture）" class="headerlink" title="微服务架构（Microservice architecture）"></a>微服务架构（Microservice architecture）</h1><p>这个例子项目，演示了如何使用微服务构建一个新的应用程序，而不是monolith-first策略。<br>由于在项目中的每一个微服务都是父项目的一个模块，这样对开发者来说是非常友好的，可以在本地中运行和开发每一个微服务。添加一个新的微服务也是非常的容易，当<strong>发现程序</strong>可以自动发现新的在集群中运行的微服务。</p>
<h1 id="服务发现（Service-discovery）"><a href="#服务发现（Service-discovery）" class="headerlink" title="服务发现（Service discovery）"></a>服务发现（Service discovery）</h1><p>这个项目包含2种类型的服务发现，其中一个是使用了Netflix Eureka, 以及另外一个是使用了Hashicorp 的 Consul。发现有多个服务提供了机会来使用一个(Consul)作为集群的DNS提供商，其他如（Eureka）作为一个API gateway 的代理。</p>
<h1 id="API-gateway"><a href="#API-gateway" class="headerlink" title="API gateway"></a>API gateway</h1><p>每一个微服务，将会和Eureka 的检索整个集群API路由线，使用此策略中的每个microservice集群可以通过一个API网关负载均衡和暴露API gateway。每个服务将自动发现和API请求路由到服务拥有路线。这个代理技术是十分有帮助的在开发用户接口的时候，作为完整的API可用的平台是通过自己的主机作为代理。</p>
<h1 id="Docker-例子"><a href="#Docker-例子" class="headerlink" title="Docker 例子"></a>Docker 例子</h1><p>这个Demo项目是使用Docker来构建一个内容镜像都是每个microservices Maven构建的一部分。我们可以轻松地安排整个microservice集群在自己的机器上使用Docker组件。</p>
<h1 id="开始这个项目"><a href="#开始这个项目" class="headerlink" title="开始这个项目"></a>开始这个项目</h1><p>你可以访问Github仓库，来获取这个例子的项目。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https://github.com/kbastani/spring-cloud-microservice-example</div></pre></td></tr></table></figure></p>
<p>拷贝这个项目，和下载这个仓库到你的机器。在下载后，你将会需要，使用Maven 和Docker去编译和构建一个本地的镜像。</p>
<h1 id="下载Docker"><a href="#下载Docker" class="headerlink" title="下载Docker"></a>下载Docker</h1><p>首先，下载一个Docker,如果你并没有安装。接着，按着这个介绍，<a href="https://docs.docker.com/compose/install/" target="_blank" rel="external">这里</a>, 去获取Docker , 以及在你的开发机器上运行。</p>
<p>你将同时需要安装 <a href="https://docs.docker.com/compose/" target="_blank" rel="external">Docker Compose</a>,这个安装指导，你可以在这里找到，<a href="https://docs.docker.com/compose/install/" target="_blank" rel="external">这里</a>. 如果你已经安装了Mac OSX 和 boot2docker,确认你的boot2docker-vm的条件，是否最小为5G内存，下面这个命令将允许你这样设置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ boot2docker init --memory=5000</div></pre></td></tr></table></figure></p>
<h1 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h1><p>运行这个Demo,需要一下这些条件：</p>
<ul>
<li>Maven3+</li>
<li>Java 8+</li>
<li>Docker </li>
<li>Docker Compose</li>
</ul>
<h1 id="构建这个项目"><a href="#构建这个项目" class="headerlink" title="构建这个项目"></a>构建这个项目</h1><p>去构建这个项目，可以开启终端在项目的根目录下运行这个命令，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ mvn clean install</div></pre></td></tr></table></figure></p>
<p>在执行，这个命令，他会帮忙下载项目工程所需要的依赖包，以及编译每一个项目工程。每一个服务都会被构建，以及Maven的Docker 插件将会自动构建每一个镜像到本地的Docker 注册。在你运行  <strong>mvn clean install</strong>命令去构建的时候 Docker 必须先被运行，并且是可用的。<br>如果构建成功，你会看到这样的信息输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[INFO] ------------------------------------------------------------------------</div><div class="line">[INFO] Reactor Summary:</div><div class="line">[INFO]</div><div class="line">[INFO] spring-cloud-microservice-example-parent .......... SUCCESS [  0.268 s]</div><div class="line">[INFO] users-microservice ................................ SUCCESS [ 11.929 s]</div><div class="line">[INFO] discovery-microservice ............................ SUCCESS [  5.640 s]</div><div class="line">[INFO] api-gateway-microservice .......................... SUCCESS [  5.156 s]</div><div class="line">[INFO] recommendation-microservice ....................... SUCCESS [  7.732 s]</div><div class="line">[INFO] config-microservice ............................... SUCCESS [  4.711 s]</div><div class="line">[INFO] hystrix-dashboard ................................. SUCCESS [  4.251 s]</div><div class="line">[INFO] consul-microservice ............................... SUCCESS [  6.763 s]</div><div class="line">[INFO] movie-microservice ................................ SUCCESS [  8.359 s]</div><div class="line">[INFO] movies-ui ......................................... SUCCESS [ 15.833 s]</div><div class="line">[INFO] ------------------------------------------------------------------------</div><div class="line">[INFO] BUILD SUCCESS</div><div class="line">[INFO] ------------------------------------------------------------------------</div></pre></td></tr></table></figure></p>
<h1 id="开始使用Docker-Compose-来组成集群"><a href="#开始使用Docker-Compose-来组成集群" class="headerlink" title="开始使用Docker Compose 来组成集群"></a>开始使用Docker Compose 来组成集群</h1><p>现在每一个镜像，已经被构建成功，我们可以使用Docker Compose 来 组成自旋向上的集群，我们将会包含一个预配置的yaml文件。<br>在项目的根目录，进入 <strong>spring-cloud-mircroservice-example/docker</strong>目录<br>现在，可以开启一个微服务集群，执行下面的命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker-compose up</div></pre></td></tr></table></figure></p>
<p>如果所有的事情都配置正确，每一个镜像都能更早的在我们自己的Docker VM 容器内，被运行构建，网络会自动服务发现. 你将会看见，一大串的log 输出，为每一个服务的开启的顺序。<br>这可能需要几分钟来编译整个程序，这个时间是由你的运行机器来决定的。</p>
<p>一旦启动顺序完成，你可以导航到 Eureka主机和看到哪些服务注册与发现服务。</p>
<p>复制和粘贴下面的命令行到你的终端，Docker能接近使用 <strong>$DOCKER_HOST</strong> 环境变量：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ open $(echo \&quot;$(echo $DOCKER_HOST)\&quot;|</div><div class="line">            \sed &apos;s/tcp:\/\//http:\/\//g&apos;|</div><div class="line">            \sed &apos;s/[0-9]\&#123;4,\&#125;/8761/g&apos;|</div><div class="line">            \sed &apos;s/\&quot;//g&apos;)</div></pre></td></tr></table></figure></p>
<p>如果 Eureka 能正确开启，浏览器窗口将会开启一个本地的Eureka 服务的面板，就如下面所展示的那样：<br><img src="http://i.imgur.com/buABI3h.png" alt="Eureka"></p>
<p>我们能看见，每一个服务实例的运行和运行状态。我们能接近这个数据驱动服务。这个演示程序的就是 <strong>movie</strong> 服务。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ open $(echo \&quot;$(echo $DOCKER_HOST)/movie\&quot;|</div><div class="line">            \sed &apos;s/tcp:\/\//http:\/\//g&apos;|</div><div class="line">            \sed &apos;s/[0-9]\&#123;4,\&#125;/10000/g&apos;|</div><div class="line">            \sed &apos;s/\&quot;//g&apos;)</div></pre></td></tr></table></figure></p>
<p>这个命令，这个命令将导航到API网关的端点和代理<strong>movie</strong>服务的REST API端点。这些REST APIs 已经使用 <strong>HATEOAS</strong>来被配置了，它支持所有的服务的自动发现功能嵌入链接。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;_links&quot; : &#123;</div><div class="line">    &quot;self&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;resume&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/resume&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;pause&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/pause&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;restart&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/restart&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;metrics&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/metrics&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;env&quot; : [ &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/env&quot;</div><div class="line">    &#125;, &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/env&quot;</div><div class="line">    &#125; ],</div><div class="line">    &quot;archaius&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/archaius&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;beans&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/beans&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;configprops&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/configprops&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;trace&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/trace&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;info&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/info&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;health&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/health&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;hystrix.stream&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/hystrix.stream&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;routes&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/routes&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;dump&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/dump&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;refresh&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/refresh&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;mappings&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/mappings&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;autoconfig&quot; : &#123;</div><div class="line">      &quot;href&quot; : &quot;http://192.168.59.103:10000/movie/autoconfig&quot;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>本系列的第一部分关于构建mircroservice架构与Spring-cloud 和 Docker。在本文章中，我们已经涉及到了以下的一些概念：</p>
<ul>
<li>服务发现（Service Discovery）</li>
<li>扩展配置（Externalized Configuration）</li>
<li>API Gateway</li>
<li>用Docker实现服务编排（Service Orchestration with Docker Compose）</li>
</ul>
<p>在下一篇博文中,我们将复习如何构建应用程序前端与后端服务集成。我们也可以关注于这个例子<a href="http://martinfowler.com/bliki/PolyglotPersistence.html" target="_blank" rel="external">polyglot persistence</a>使用Mysql(关系型数据库) 和 Neo4j(图形数据库)。</p>
<h1 id="特别感谢"><a href="#特别感谢" class="headerlink" title="特别感谢"></a>特别感谢</h1><p>我将会特别感谢<a href="http://www.twitter.com/starbuxman" target="_blank" rel="external">Josh Long</a> 和 spring 的 rest 团队给与我这个机会去学习spring 框架提供的第一手精美的东西。没有杰克的指导我将无法用语言表达的所有神奇的spring生态系统所能提供的东西。</p>
<p>这里有很多开源工具，想Spring Cloud。 这将是件不可能的事情，如果没有这些人的思想领导，如：<a href="https://twitter.com/adrianco" target="_blank" rel="external">Adrian Cockcroft (Netflix OSS)</a>, <a href="https://twitter.com/martinfowler" target="_blank" rel="external">Martin Fowler (everything)</a><br><a href="https://twitter.com/samnewman" target="_blank" rel="external">Sam Newman (O’Reilly’s Building Microservices)</a>, <a href="https://twitter.com/iansrobinson" target="_blank" rel="external"> Ian Robinson (consumer driven contracts)</a><br><a href="https://twitter.com/crichardson" target="_blank" rel="external"> Chris Richardson (Cloud Foundry) </a> 以及很多其他参与到开源工作的人们。</p>
<blockquote>
<p>参考：<br><a href="http://www.kennybastani.com/2015/07/spring-cloud-docker-microservices.html" target="_blank" rel="external">http://www.kennybastani.com/2015/07/spring-cloud-docker-microservices.html</a></p>
</blockquote>

            </div>
        </div>
    </div>
</article>




    <section id="comment">
        <div class="card">
            <div class="card-content">
                <!-- Duoshuo Comment BEGIN -->
                <div class="ds-thread" data-thread-key="2016/11/26/translation/1/" data-title="翻译spring-cloud的一篇文章" data-url="http://jbeacon.top/2016/11/26/translation/1/"></div>

                <script type="text/javascript">
                    console.log(document.querySelector('.ds-thread'));
                    var duoshuoQuery = {
                        short_name: 'jbeacon'
                    };
                    (function() {
                        var ds = document.createElement('script');
                        ds.type = 'text/javascript';
                        ds.async = true;
                        ds.src = (document.location.protocol == 'https:'
                            ? 'https:'
                            : 'http:') + '//static.duoshuo.com/embed.js';
                        ds.charset = 'UTF-8';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
                    })();
                </script>
                <!-- Duoshuo Comment END -->
            </div>
        </div>
    </section>



</div>

        <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large green">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect blue" title="回到顶部"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse orange"  data-activates="main-menu" title="menu"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

    </main>
    <footer class="page-footer indigo darken-1">
    
    <div class="container">
        <div class="row">
            
            <div class="social-group col m3 s12">
                <h5 class="white-text">社交</h5>
                
                    <a class="social-link" href="http://weibo.com/3099694953/profile?topnav=1&amp;wvr=6&amp;is_all=1" target="_blank">
                        <i class="fa fa-2x fa-weibo"></i>
                    </a>
                
                    <a class="social-link" href="https://github.com/RiXiong" target="_blank">
                        <i class="fa fa-2x fa-github"></i>
                    </a>
                
                    <a class="social-link" href="/atom.xml" target="_blank">
                        <i class="fa fa-2x fa-rss"></i>
                    </a>
                
            </div>
            

            
            <div class="col m9 s12">
                <h5 class="white-text">友情链接</h5>
                
                    <a class="social-link" href="http://raytaylorlin.com/" target="_blank">raytaylorism主题作者的技术博客</a>
                
                    <a class="social-link" href="https://github.com/raytaylorlin" target="_blank">Github地址（测试友情链接）</a>
                
            </div>
            
        </div>
    </div>
    

    <div class="footer-copyright indigo-link-context">
        <div class="container">
            © 2016 jbeacon.top, All rights reserved.
            <p class="right" style="margin-top: 0;">本博客由 <a href="https://hexo.io">Hexo</a> 强力驱动 | 主题 <a href="https://github.com/raytaylorlin/hexo-theme-raytaylorism">raytaylorism</a></p>
        </div>
    </div>
</footer>


    <noscript>
    <div class="noscript">
        <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    (function($) {
        $(document).ready(function() {
            // 隐藏禁用javascript（针对微信内置浏览器）的提示
            $('.noscript').hide();

            // 图片缩放效果
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // 给图片加上点击放大效果（materialbox插件）
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // 优化表格的显示
            $('table').each(function() {
                var $table = $(this);
                // 除去多行代码的情况
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // 首页幻灯片
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // 针对gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // 文章目录
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();
            // 修正文章目录的left-border颜色
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // 针对移动端做的优化：FAB按钮点击一下收回
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // 回到顶部
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // 重置读书页面的Tab标签页的颜色
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('green lighten-2');

            
            // 添加new标签
            $('.menu-reading, .menu-about').append('<span class="new badge pink"></span>');
            

            // 搜索功能
            $('.modal-trigger').leanModal({
                // 打开搜索框时自动聚焦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "search.xml";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // 初始化搜索与匹配函数
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword indigo lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword indigo lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>




<script type="text/javascript" src="http://tajs.qq.com/stats?sId=a4Ho46rhVw4-PQxU" charset="UTF-8"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" async
  src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



</body>
</html>
